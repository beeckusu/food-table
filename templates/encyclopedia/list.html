{% extends 'base.html' %}
{% load static %}

{% block title %}Encyclopedia - Food Table{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/encyclopedia_tree.css' %}">
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">Encyclopedia</h1>
        <p class="lead">Browse our hierarchical collection of food knowledge entries</p>
    </div>
</div>

{% if entries %}
<!-- Tree Controls -->
<div class="tree-controls">
    <button type="button" class="tree-control-btn" id="expand-all-btn" aria-label="Expand all entries">
        <i class="bi bi-arrows-expand" aria-hidden="true"></i>
        Expand All
    </button>
    <button type="button" class="tree-control-btn" id="collapse-all-btn" aria-label="Collapse all entries">
        <i class="bi bi-arrows-collapse" aria-hidden="true"></i>
        Collapse All
    </button>
</div>

<!-- Tree View -->
<div role="tree" aria-label="Encyclopedia entries hierarchical view">
    <ul class="encyclopedia-tree">
        {% for entry in entries %}
        <li class="tree-entry" data-depth="{{ entry.depth }}" role="treeitem" aria-expanded="false">
            <div class="tree-entry-content">
                <!-- Expand/Collapse Toggle or Placeholder -->
                {% if entry.has_children %}
                <button type="button"
                        class="tree-toggle"
                        aria-label="Expand {{ entry.name }}"
                        data-entry-id="{{ entry.id }}">
                    <i class="bi bi-chevron-right" aria-hidden="true"></i>
                </button>
                {% else %}
                <div class="tree-toggle-placeholder" aria-hidden="true"></div>
                {% endif %}

                <!-- Entry Icon -->
                {% if entry.has_children %}
                <i class="bi bi-folder tree-icon folder-icon" aria-hidden="true"></i>
                {% else %}
                <i class="bi bi-file-text tree-icon leaf-icon" aria-hidden="true"></i>
                {% endif %}

                <!-- Entry Name (Link) -->
                <a href="{% url 'content:encyclopedia_detail' entry.slug %}"
                   class="tree-entry-link">
                    {{ entry.name }}
                </a>

                <!-- Child Count Badge -->
                {% if entry.has_children %}
                <span class="child-count-badge"
                      aria-label="{{ entry.children_count }} child entries">
                    {{ entry.children_count }}
                </span>
                {% endif %}
            </div>

            <!-- Children Container (Initially Collapsed) -->
            {% if entry.has_children %}
            <div class="tree-children collapsed"
                 id="children-{{ entry.id }}"
                 role="group">
                <!-- Children will be loaded here (future JS implementation) -->
            </div>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
</div>
{% else %}
<div class="alert alert-info">
    No encyclopedia entries found. Create some entries in the admin panel to get started.
</div>
{% endif %}
{% endblock %}
